#!/usr/bin/env zsh
# This script deletes files generated by tex compilation in subdirectories. Only
# files with the same name as a tex file in its directory will be deleted.

MAX_DEPTH=3
echo "[*] Doing tex cleanup using depth $MAX_DEPTH..."

while read -r tex; do
  if [ -z $tex ]; then
    continue
  fi
  echo "  [+] Found $tex!"
  tex_dir=$(dirname $tex)
  tex_file=$(basename $tex)
  tex_name=${tex_file%.*}
  find $tex_dir -maxdepth 1 -type f \
    \( -iname $tex_name.fdb_latexmk \
    -o -iname $tex_name.fls \
    -o -iname $tex_name.synctex.gz \
    -o -iname $tex_name.aux \
    -o -iname $tex_name.log \
    -o -iname $tex_name.xdv \
    -o -iname $tex_name.bbl \
    -o -iname $tex_name.blg \
    -o -iname $tex_name.nav \
    -o -iname $tex_name.out \
    -o -iname $tex_name.snm \
    -o -iname $tex_name.toc \) \
    -exec echo "    [*] Deleting" {}"..." \; \
    -delete
done <<< $(find ./ -maxdepth $MAX_DEPTH -type f -name "*.tex")
